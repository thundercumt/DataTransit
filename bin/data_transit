#!/usr/bin/env ruby

require File::expand_path('../../lib/datatransit/cli', __FILE__)

command = ARGV[0]

help_msg = "usage: data_transit command args. 4 commands are listed below\n
1 data_transit setup_db_conn [conn.yml]
conn.yml: the yml file describing db connection and adapters\n
2 data_transit dump_schema [schema_file] [rule_file]
schema_file: the file to store source database schema
rule_file: the user migration rule\n
3 data_transit create_table [schema_file]
schema_file: the file generated by dump_schema\n
4 data_transit copy_data [rule_file]
rule_file: the user migration rule"
 
case command
when "setup_db_conn"
  yml = ARGV[1]
  if File::exists?(yml)
    setup_db_conn yml
  else
    print "file #{yml} does not exist!\n"
  end
  
when "dump_schema"
  schema = ARGV[1]
  rule = ARGV[2]
  if not (schema =~ /\.rb$/)
    schema += ".rb"
  end
  dump_schema schema, rule
when "create_table"
  create_tables ARGV[1]
when "copy_data"
  copy_data ARGV[1]
else
  puts help_msg
end